{  "state":"Active",  "created_at":"2010-08-19 00:00:00",  "expires_at":"2011-02-19 00:00:00",  "publication":"Crikey Daily Mail",  "price":"65.0000",  "offer":"6 Month Subscription",  "source":"",  "list":"6 Month Subscription",  "status":"0",  "auto_renew":"0"}


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `users` AS select `crm_emailaddress`.`Email` as email, concat('\n{\n  \"firstname\":\"',`active_contactversion`.`FirstName`,'\",\n  \"lastname\":\"',`active_contactversion`.`LastName`,'\",\n  \"title\":\"',convert(`active_contactversion`.`Title` using utf8),'\",\n  \"login\":\"',convert(`active_contactversion`.`Username` using utf8),'\",\n  \"company\":\"',`active_contactversion`.`Company`,'\",\n  \"address_1":\"',`crm_address`.`Street1`,'\",\n  \"address_2\":\"',`crm_address`.`Street2`,'\",\n  \"city\":\"',`crm_address`.`Suburb`,'\",\n  \"state\":\"',`crm_address`.`State`,'\",\n  \"postcode\":\"',convert(`crm_address`.`Postcode` using utf8),'\",\n  \"country\":\"',convert(`crm_address`.`Country` using utf8),'\",\n  \"phone_number\":\"',convert(ifnull(`active_contactversion`.`HomePhone`,ifnull(`active_contactversion`.`WorkPhone`,`active_contactversion`.`MobilePhone`)) using utf8),'\",\n \"email\":\"',convert(`crm_emailaddress`.`Email` using utf8),'\"\n}\n') AS `user`,concat('\n{\n  \"last_login_at\":\"',`active_contactversion`.`LastLoginDate`,'\",\n  \"last_login_ip\":\"',`active_contactversion`.`IpAddress`,'\",\n  \"created_at\":\"',`active_contactversion`.`DateCreated`,'\"\n }\n') AS `access`,`active_contactversion`.`ContactId` AS `ContactId` from ((((`active_contactversion` join `crm_contactemailaddress` on((`active_contactversion`.`VersionId` = `crm_contactemailaddress`.`VersionId`))) join `crm_emailaddress` on((`crm_contactemailaddress`.`EmailAddressId` = `crm_emailaddress`.`EmailAddressId`))) join `crm_contactaddress` on((`active_contactversion`.`VersionId` = `crm_contactaddress`.`VersionId`))) join `crm_address` on((`crm_contactaddress`.`AddressId` = `crm_address`.`AddressId`))) where ((`crm_emailaddress`.`Status` = 1) and (`crm_address`.`MainContact` = 1))


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `subscriptions` AS select `crm_contactcontactlist`.`ContactId` AS `ContactId`,group_concat(concat('\n{\n  \"state\":\"',convert(`list_subscriptions`.`state` using utf8),'\",\n  \"created_at\":\"',ifnull(`crm_contactcontactlist`.`DateCommences`,''),'\",\n  \"expires_at\":\"',ifnull(`crm_contactcontactlist`.`DateExpires`,''),'\",\n \"publication\":\"',convert(`list_subscriptions`.`publication` using utf8),'\",\n  \"price\":\"',ifnull(`crm_product`.`Price`,0),'\",\n  \"offer\":\"',convert(ifnull(`list_subscriptions`.`offer`,'') using utf8),'\",\n  \"source\":\"',convert(ifnull(`list_subscriptions`.`source`,'') using utf8),'\",\n  \"list\":\"',`crm_contactlist`.`Title`,'\",\n  \"status\":\"',`crm_contactcontactlist`.`Status`,'\",\n  \"auto_renew\":\"',if(`crm_contactcontactlist`.`RenewalImport`,1,0),'\"\n}\n') separator ',') AS `subscriptions` from ((((`crm_contactcontactlist` join `crm_contact` on((`crm_contactcontactlist`.`ContactId` = `crm_contact`.`ContactId`))) join `crm_contactlist` on((`crm_contactcontactlist`.`ContactListId` = `crm_contactlist`.`ContactListId`))) join `list_subscriptions` on((`crm_contactlist`.`Title` = convert(`list_subscriptions`.`list` using utf8)))) join `crm_product` on((`crm_contactcontactlist`.`ContactListId` = `crm_product`.`ContactListId`))) where (`crm_contactcontactlist`.`Status` = `list_subscriptions`.`status`) group by `crm_contactcontactlist`.`ContactId`
