<%= render_table actions, :name => 'action_history' do |t| 
  t.header :date, :sort_by => :created_at
  t.header :renewal
  unless @user
    t.header :user
  end
  t.header :publication
  t.header :amount
  t.header :payment_reference
  t.header :offer_name
  t.header :term
  t.header :source
  t.header :gifts

  t.rows do |row, action, index|
    row.renewal action.renewal? ? 'Yes' : 'No'
    row.date format_timestamp(action.applied_at)
    unless @user || action.subscription.user.blank?
      row.user link_to(action.subscription.user.name, admin_subscriber_path(action.subscription.user))
    end
    row.publication link_to(action.subscription.publication.name, admin_catalogue_publication_path(action.subscription.publication))
    row.amount number_to_currency(action.payment.try(:amount) || 0)
    unless action.payment.blank?
      row.payment_reference link_to(action.payment.reference, admin_payment_path(action.payment))
    end
    row.offer_name action.offer_name
    row.term pluralize(action.term_length, "month")
    row.source action.source.try(:name)
    row.gifts action.gifts.size
  end
end %>

